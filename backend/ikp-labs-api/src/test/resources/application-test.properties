# ===================================================================
# SPRING BOOT TEST CONFIGURATION
# ===================================================================
# File ini untuk konfigurasi testing
# Database: H2 in-memory (temporary, hilang setelah test)
# Tidak ganggu database production (PostgreSQL)

# ===================================================================
# H2 DATABASE CONFIGURATION (In-Memory untuk Testing)
# ===================================================================
spring.datasource.driver-class-name=org.h2.Driver
spring.datasource.url=jdbc:h2:mem:testdb;DB_CLOSE_DELAY=-1;DB_CLOSE_ON_EXIT=FALSE
spring.datasource.username=sa
spring.datasource.password=

# ===================================================================
# JPA / HIBERNATE CONFIGURATION
# ===================================================================
# Use standard H2 Dialect (not PostgreSQL compatibility)
# This avoids "RETURNING id" syntax error
spring.jpa.database-platform=org.hibernate.dialect.H2Dialect

# Hibernate DDL mode: create-drop
# - create: Buat table saat start
# - drop: Hapus table saat end
# - Tidak pakai Flyway migration untuk test (terlalu slow)
spring.jpa.hibernate.ddl-auto=create-drop

# Show SQL queries di console (untuk debugging)
spring.jpa.show-sql=false

# Format SQL agar mudah dibaca
spring.jpa.properties.hibernate.format_sql=true

# ===================================================================
# FLYWAY MIGRATION (Disabled untuk Test)
# ===================================================================
# Kenapa disabled?
# - Test menggunakan Hibernate ddl-auto=create-drop
# - Lebih cepat daripada run migration
# - Test dapat fresh database setiap kali
spring.flyway.enabled=false

# ===================================================================
# LOGGING CONFIGURATION
# ===================================================================
# Disable most logging untuk test (lebih cepat & clean output)
logging.level.root=WARN
logging.level.com.registrationform.api=INFO
logging.level.org.hibernate.SQL=DEBUG
logging.level.org.hibernate.type.descriptor.sql.BasicBinder=TRACE

# ===================================================================
# FILE UPLOAD CONFIGURATION
# ===================================================================
# Test tidak butuh real file storage
# Mock file operations di test code
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=5MB
spring.servlet.multipart.max-request-size=5MB

file.upload.directory=uploads/profiles/
file.upload.gallery-directory=uploads/gallery/

# ===================================================================
# JWT CONFIGURATION (Same as production untuk consistency)
# ===================================================================
jwt.secret=your-256-bit-secret-key-for-jwt-signing-and-verification-min-32-chars
jwt.expiration=86400000

# ===================================================================
# NOTES UNTUK PEMAHAMAN:
# ===================================================================
#
# 1. Kenapa H2 bukan PostgreSQL untuk test?
#    - H2 = in-memory database (RAM only)
#    - Sangat cepat (tidak perlu disk I/O)
#    - Tidak perlu install database terpisah
#    - Clean slate setiap test
#    - PostgreSQL compatibility mode
#
# 2. MODE=PostgreSQL itu apa?
#    - H2 bisa "pretend" jadi PostgreSQL
#    - Support syntax PostgreSQL (hampir semua)
#    - SERIAL, BIGSERIAL, BOOLEAN, dll.
#    - Tidak 100% compatible, tapi cukup untuk test
#
# 3. DB_CLOSE_DELAY=-1 itu apa?
#    - Database tetap hidup sampai JVM mati
#    - Tidak close saat connection terakhir ditutup
#    - Penting untuk Spring Test (banyak open/close connection)
#
# 4. Kenapa ddl-auto=create-drop?
#    - Test butuh fresh database
#    - Hibernate auto-generate table dari @Entity
#    - Lebih cepat dari Flyway migration
#    - Drop semua table saat test selesai
#
# 5. Kenapa Flyway disabled?
#    - Flyway untuk production (versioning, rollback)
#    - Test tidak butuh versioning
#    - Hibernate ddl-auto lebih cepat
#    - Avoid conflict antara Flyway & Hibernate
#
# 6. Integration dengan @DataJpaTest:
#    - @DataJpaTest auto-load application-test.properties
#    - Setup H2 database otomatis
#    - Rollback setiap test (clean state)
#    - Only load JPA-related beans (fast startup)
#
# 7. Perbedaan dengan Production:
#    Production: PostgreSQL + Flyway migration + persistent storage
#    Test: H2 + Hibernate ddl-auto + in-memory
#
# 8. Kapan properties ini dipakai?
#    - Otomatis saat run test (mvn test)
#    - @DataJpaTest, @SpringBootTest dengan profile=test
#    - Tidak ganggu application.properties production

# Use H2-compatible ID generation (fix RETURNING id error)
# H2 doesn't support PostgreSQL "RETURNING id" syntax
spring.jpa.properties.hibernate.jdbc.use_get_generated_keys=false
spring.jpa.properties.hibernate.id.new_generator_mappings=false
