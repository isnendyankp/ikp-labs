# ===================================================================
# INTEGRATION TEST CONFIGURATION WITH TESTCONTAINERS
# ===================================================================
# File ini khusus untuk integration tests menggunakan Testcontainers
# Database: PostgreSQL real di Docker container
# Lebih akurat dari H2 karena menggunakan database production-like

# ===================================================================
# DATABASE CONFIGURATION
# ===================================================================
# URL, username, password akan di-override oleh Testcontainers
# di BaseIntegrationTest class
# Format: jdbc:tc:postgresql:15:///testdb
spring.datasource.driver-class-name=org.postgresql.Driver

# HikariCP Connection Pool Configuration for Integration Tests
# Optimize for test stability and prevent stale connections
spring.datasource.hikari.maximum-pool-size=5
spring.datasource.hikari.minimum-idle=2
spring.datasource.hikari.connection-timeout=10000
spring.datasource.hikari.idle-timeout=30000
spring.datasource.hikari.max-lifetime=60000
spring.datasource.hikari.validation-timeout=3000
spring.datasource.hikari.leak-detection-threshold=15000

# ===================================================================
# JPA / HIBERNATE CONFIGURATION
# ===================================================================
# Use PostgreSQL Dialect (real database)
spring.jpa.database-platform=org.hibernate.dialect.PostgreSQLDialect

# DDL mode: create-drop untuk integration tests
# - create: Buat table saat start
# - drop: Hapus table saat end
spring.jpa.hibernate.ddl-auto=create-drop

# Show SQL untuk debugging (optional)
spring.jpa.show-sql=false
spring.jpa.properties.hibernate.format_sql=true

# ===================================================================
# FLYWAY MIGRATION (Disabled untuk Integration Test)
# ===================================================================
# Integration test menggunakan Hibernate ddl-auto
# Flyway disabled untuk simplicity dan speed
spring.flyway.enabled=false

# ===================================================================
# LOGGING CONFIGURATION
# ===================================================================
logging.level.root=WARN
logging.level.com.registrationform.api=INFO
logging.level.org.testcontainers=INFO
logging.level.org.hibernate.SQL=DEBUG

# ===================================================================
# FILE UPLOAD CONFIGURATION
# ===================================================================
spring.servlet.multipart.enabled=true
spring.servlet.multipart.max-file-size=5MB
spring.servlet.multipart.max-request-size=5MB

file.upload.directory=uploads/profiles/
file.upload.gallery-directory=uploads/gallery/

# ===================================================================
# JWT CONFIGURATION
# ===================================================================
jwt.secret=your-256-bit-secret-key-for-jwt-signing-and-verification-min-32-chars
jwt.expiration=86400000

# ===================================================================
# SPRING TEST CONFIGURATION
# ===================================================================
# Enable test database initialization
spring.test.database.replace=none

# ===================================================================
# NOTES:
# ===================================================================
# 1. Testcontainers akan:
#    - Start PostgreSQL Docker container otomatis
#    - Set dynamic port (tidak conflict)
#    - Override datasource URL/username/password
#    - Cleanup container setelah test selesai
#
# 2. Keuntungan vs H2:
#    - Test dengan database production-like (PostgreSQL)
#    - Detect PostgreSQL-specific issues
#    - More reliable integration testing
#    - Support semua PostgreSQL features
#
# 3. Trade-off:
#    - Slower than H2 (need to start Docker container)
#    - Requires Docker running on machine
#    - Use for critical integration tests only
